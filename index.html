<script type="text/javascript">
    let model, maxPredictions;

    async function init() {
      const URL = "https://kld-ai.github.io/000/";  // هذا رابط ملفات النموذج في GitHub Pages
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      try {
        model = await tmImage.load(modelURL, metadataURL);
        console.log("✅ النموذج جاهز!");
        maxPredictions = model.getTotalClasses();
      } catch (error) {
        console.error("❌ خطأ في تحميل النموذج:", error);
      }
    }

    const imageUpload = document.getElementById("imageUpload");
    const preview = document.getElementById("preview");
    const confirmButton = document.getElementById("confirmButton");
    let imgLoaded = false;

    imageUpload.addEventListener("change", (event) => {
      const file = event.target.files[0];
      if (!file) return;

      preview.src = URL.createObjectURL(file);
      preview.style.display = "block";
      confirmButton.disabled = false;
      imgLoaded = true;
    });

    confirmButton.addEventListener("click", async () => {
      if (!imgLoaded) return;

      try {
        const prediction = await model.predict(preview, false);
        prediction.sort((a, b) => b.probability - a.probability);
        const bestMatch = prediction[0];
        document.getElementById('result').innerHTML = 
          `🚘 التصنيف المتوقع: <span style="color:blue;">${bestMatch.className}</span> <br> 🔥 الثقة: ${(bestMatch.probability * 100).toFixed(2)}%`;
      } catch (error) {
        console.error("❌ خطأ أثناء التنبؤ:", error);
      }
    });

    window.addEventListener('load', init);
</script>
