<script type="text/javascript">
    let model, maxPredictions;

    async function init() {
      const URL = "./"; 
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      try {
        model = await tmImage.load(modelURL, metadataURL);
        console.log("✅ النموذج جاهز!");
        maxPredictions = model.getTotalClasses();
      } catch (error) {
        console.error("❌ خطأ في تحميل النموذج:", error);
      }
    }

    document.getElementById("imageUpload").addEventListener("change", async (event) => {
      const file = event.target.files[0];
      if (!file) return;

      const img = document.getElementById('preview');
      img.src = URL.createObjectURL(file);
      img.onload = async () => {
        try {
          const prediction = await model.predict(img, false);
          prediction.sort((a, b) => b.probability - a.probability);
          const bestMatch = prediction[0];
          document.getElementById('result').innerHTML = `🚘 التصنيف المتوقع: <span style="color:blue;">${bestMatch.className}</span> <br> 🔥 الثقة: ${(bestMatch.probability * 100).toFixed(2)}%`;
        } catch (error) {
          console.error("❌ خطأ أثناء التنبؤ:", error);
        }
      };
    });

    window.addEventListener('load', init);
</script>
